#!/bin/bash

echo ""
echo "üîç Running pre-commit checks..."
echo "================================"
echo ""

# R√©cup√®re les fichiers Kotlin modifi√©s
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "\.kt$")

if [ -z "$STAGED_FILES" ]; then
    echo "‚úÖ No Kotlin files to check"
    exit 0
fi

echo "üìù Kotlin files to check:"
echo "$STAGED_FILES"
echo ""

# Formate le code avec Spotless
echo "üé® Formatting code with spotlessApply..."
./gradlew spotlessApply --daemon

SPOTLESS_STATUS=$?

if [ $SPOTLESS_STATUS -ne 0 ]; then
    echo ""
    echo "‚ùå Spotless formatting failed!"
    echo "Fix the errors and try again."
    exit 1
fi

# Ajoute les changements format√©s au commit
echo ""
echo "‚úÖ Code formatted successfully"
echo "üì¶ Adding formatted files to commit..."

for FILE in $STAGED_FILES; do
    if [ -f "$FILE" ]; then
        git add "$FILE"
    fi
done

echo ""
echo "‚úÖ Pre-commit checks passed!"
echo "================================"
echo ""

exit 0
